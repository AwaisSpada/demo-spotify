(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6027:function(e,t,i){Promise.resolve().then(i.bind(i,5900)),Promise.resolve().then(i.bind(i,5797)),Promise.resolve().then(i.t.bind(i,5878,23))},5900:function(e,t,i){"use strict";i.d(t,{default:function(){return s}});var n=i(7437),a=i(605);function s(){let{data:e,status:t}=(0,a.useSession)();return"loading"===t?(0,n.jsx)("button",{disabled:!0,children:"Loading"}):e?(0,n.jsx)("button",{onClick:()=>(0,a.signOut)(),children:"Sign out"}):(0,n.jsx)("button",{onClick:()=>(0,a.signIn)("spotify"),children:"Sign in with Spotify"})}},5797:function(e,t,i){"use strict";i.d(t,{default:function(){return r}});var n=i(7437),a=i(2265),s=i(3145);function r(){let[e,t]=(0,a.useState)(!1),[i,r]=(0,a.useState)(null),[l,o]=(0,a.useState)([]),[d,c]=(0,a.useState)(null),[u,h]=(0,a.useState)([]),[y,f]=(0,a.useState)(null),[p,m]=(0,a.useState)(!1),[v,j]=(0,a.useState)(!1),w=(0,a.useMemo)(()=>u.map(e=>{var t;return null===(t=e.track)||void 0===t?void 0:t.uri}).filter(Boolean),[u]),g=(0,a.useRef)(null);(0,a.useEffect)(()=>{(async()=>{t(!0),r(null);try{let e=await fetch("/api/spotify/playlists");if(!e.ok)throw Error("Failed to load playlists");let t=await e.json();o(t.items||[])}catch(e){r(e.message||"Something went wrong")}finally{t(!1)}})()},[]),(0,a.useEffect)(()=>{d&&(async()=>{t(!0),r(null);try{let e=await fetch("/api/spotify/playlists/".concat(d.id,"/tracks"));if(!e.ok)throw Error("Failed to load tracks");let t=await e.json();h(t.items||[])}catch(e){r(e.message||"Something went wrong")}finally{t(!1)}})()},[d]),(0,a.useEffect)(()=>{if(window.Spotify){x();return}let e=document.createElement("script");return e.src="https://sdk.scdn.co/spotify-player.js",e.async=!0,document.body.appendChild(e),window.onSpotifyWebPlaybackSDKReady=()=>x(),()=>{e.remove()}},[]);let x=()=>{if(g.current)return;let e=window.Spotify;if(!e)return;let t=new e.Player({name:"Next.js Web Player",getOAuthToken:async e=>{await fetch("/api/spotify/me")},volume:.5});t.addListener("ready",e=>{let{device_id:t}=e;f(t),m(!0)}),t.addListener("not_ready",e=>{let{device_id:t}=e;t===y&&m(!1)}),t.addListener("player_state_changed",e=>{e&&j(!e.paused)}),t.addListener("initialization_error",e=>{let{message:t}=e;return r(t)}),t.addListener("authentication_error",e=>{let{message:t}=e;return r(t)}),t.addListener("account_error",e=>{let{message:t}=e;return r(t)}),t.connect(),g.current=t},k=async()=>{y&&((await fetch("/api/spotify/player/transfer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({deviceId:y})})).ok||r("Transfer playback failed (Premium required)"))},b=async()=>{y&&0!==w.length&&(await k(),(await fetch("/api/spotify/player/play",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({deviceId:y,uris:w})})).ok||r("Play failed (Premium required)"))},S=async()=>{(await fetch("/api/spotify/player/pause",{method:"POST"})).ok||r("Pause failed")},P=async()=>{(await fetch("/api/spotify/player/next",{method:"POST"})).ok||r("Next failed")},N=async()=>{(await fetch("/api/spotify/player/previous",{method:"POST"})).ok||r("Previous failed")};return(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{children:"Your Playlists"}),e&&(0,n.jsx)("p",{children:"Loading…"}),i&&(0,n.jsx)("p",{style:{color:"crimson"},children:i}),(0,n.jsx)("div",{className:"grid",style:{marginTop:12},children:l.map(e=>{var t,i,a,r;return(0,n.jsxs)("button",{className:"card",onClick:()=>c(e),children:[(null===(i=e.images)||void 0===i?void 0:null===(t=i[0])||void 0===t?void 0:t.url)&&(0,n.jsx)(s.default,{src:e.images[0].url,alt:e.name,width:160,height:160,style:{width:"100%",height:"auto",borderRadius:6}}),(0,n.jsx)("div",{style:{marginTop:8,fontWeight:600},children:e.name}),(0,n.jsxs)("div",{className:"muted",children:[null!==(r=null===(a=e.tracks)||void 0===a?void 0:a.total)&&void 0!==r?r:0," tracks"]})]},e.id)})}),d&&(0,n.jsxs)("div",{style:{marginTop:24},children:[(0,n.jsxs)("h3",{children:["Tracks in “",d.name,"”"]}),(0,n.jsx)("div",{className:"grid",style:{gridTemplateColumns:"1fr"},children:u.map((e,t)=>{var i,a;let r=e.track;if(!r)return null;let l=null===(a=r.album.images)||void 0===a?void 0:null===(i=a[0])||void 0===i?void 0:i.url;return(0,n.jsxs)("div",{className:"card row",style:{justifyContent:"space-between"},children:[(0,n.jsxs)("div",{className:"row",children:[l&&(0,n.jsx)(s.default,{src:l,alt:r.name,width:48,height:48}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontWeight:600},children:r.name}),(0,n.jsx)("div",{className:"muted",children:r.artists.map(e=>e.name).join(", ")})]})]}),(0,n.jsx)("div",{className:"row",children:(0,n.jsx)("button",{onClick:b,children:"Play"})})]},r.id||t)})}),(0,n.jsxs)("div",{className:"row",style:{gap:12,marginTop:16},children:[(0,n.jsx)("button",{onClick:N,children:"Previous"}),(0,n.jsx)("button",{onClick:()=>v?S():b(),children:v?"Pause":"Play"}),(0,n.jsx)("button",{onClick:P,children:"Next"}),(0,n.jsx)("button",{disabled:!p,onClick:k,children:"Transfer to Web Player"}),(0,n.jsxs)("span",{className:"muted",children:["Device: ",p&&y?y:"Not ready"]})]})]})]})}}},function(e){e.O(0,[605,145,971,117,744],function(){return e(e.s=6027)}),_N_E=e.O()}]);